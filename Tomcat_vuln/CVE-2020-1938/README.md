#### CVE-2020-1938

##### 漏洞描述

CVE-2020-1938是由于Apache Tomcat服务器存在文件包含漏洞，攻击者可利用该漏洞读取或包含 Tomcat 上所有 webapp 目录下的任意文件，如：webapp 配置文件或源代码等。

由于Tomcat默认开启的AJP服务（8009端口）存在一处文件包含缺陷，攻击者可构造恶意的请求包进行文件包含操作，进而读取受影响Tomcat服务器上的Web目录文件。

##### 影响范围

Apache Tomcat 6

Apache Tomcat 7 < 7.0.100

Apache Tomcat 8 < 8.5.51

Apache Tomcat 9 < 9.0.31

##### 漏洞原理

由于Tomcat默认开启的AJP服务（8009端口）存在一处文件包含缺陷，攻击者可构造恶意的请求包进行文件包含操作，进而读取受影响Tomcat服务器上的Web目录文件。

##### 漏洞条件

无条件（漏洞环境[参考](https://github.com/0nise/CVE-2020-1938)zip解压并执行）

##### 漏洞检测

1、URL访问

```
http://192.168.3.167:8080/
```

![image-20200813153350723](https://github.com/si1ent-le/vuln-all/Tomcat_vuln/CVE-2020-1938/images/image-20200813153350723.png)

2、端口号检测

![image-20200813153640165](https://github.com/si1ent-le/vuln-all/Tomcat_vuln/CVE-2020-1938/images/image-20200813153640165.png)

由上可以知道目标主机开放8009端口号。

3、PoC读取文件

```
python CNVD-2020-10487-Tomcat-Ajp-lfi.py 192.168.3.167 -p 8009 -f WEB-INF/web.xml
```

![image-20200813153702055](https://github.com/si1ent-le/vuln-all/Tomcat_vuln/CVE-2020-1938/image-20200813153702055.png)

##### 漏洞修复

1、下载最新

```
https://tomcat.apache.org/download-70.cgi
https://tomcat.apache.org/download-80.cgi
https://tomcat.apache.org/download-90.cgi
https://github.com/apache/tomcat/releases
```

2、临时禁用AJP协议端口，

在conf/server.xml

`注释此行<Connector port="8009" protocol="AJP/1.3"redirectPort="8443" />`

![image-20200813154014736](https://github.com/si1ent-le/vuln-all/Tomcat_vuln/CVE-2020-1938/image-20200813154014736.png)
